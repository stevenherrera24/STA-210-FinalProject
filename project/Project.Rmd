---
title: "Project"
author: "Steven Herrera and Ethan Shen"
date: "11/09/2018"
output:
  html_document: default
  pdf_document: default
---

```{r load-packages, message=FALSE}
library(tidyverse)
library(olsrr)
library(cowplot)
library(car)
library(broom)
library(knitr)
```

```{r message=FALSE, include=FALSE}
atp <- read_csv("files/atp.csv")
atp2016 <- read_csv("files/atp2016.csv")
atp2015 <- read_csv("files/atp2015.csv")
atp2014 <- read_csv("files/atp2014.csv")
atp2013 <- read_csv("files/atp2013.csv")
atp2012 <- read_csv("files/atp2012.csv")
atp2011 <- read_csv("files/atp2011.csv")
atp2010 <- read_csv("files/atp2010.csv")

atp1 <- atp %>%
  filter(tourney_date < 20171113)

winners2016 <- atp2016 %>%
  filter(tourney_date < 20161114)

winners2015 <- atp2015 %>%
  filter(tourney_date < 20151115) 

winners2014 <- atp2014 %>%
  filter(tourney_date < 20141109) 

winners2013 <- atp2013 %>%
  filter(tourney_date < 20131104) 

winners2012 <- atp2012 %>%
  filter(tourney_date < 20121105) 

winners2011 <- atp2011 %>%
  filter(tourney_date < 20111114) 

winners2010 <- atp2010 %>%
  filter(tourney_date < 20101121) 

winners <- rbind(winners2017, winners2016, winners2015, winners2014, winners2013, 
                 winners2012, winners2011, winners2010)
```


```{r}
winners_set <- winners %>%
  filter(best_of == 3,
         !is.na(w_ace), 
         !is.na(w_df), 
         !is.na(w_svpt), 
         !is.na(w_1stIn), 
         !is.na(w_1stWon), 
         !is.na(w_2ndWon),
         !is.na(w_SvGms), 
         !is.na(w_bpSaved),
         !is.na(w_bpFaced))
```

```{r}
winners <- winners_set %>%
  mutate(seed = winner_seed,
         name = winner_name,
         hand = winner_hand,
         ht = winner_ht,
         age = winner_age,
         rank = winner_rank,
         rankpoints = winner_rank_points,
         ace = w_ace,
         df = w_df,
         svpt = w_svpt,
         firsstIn = w_1stIn,
         firsttWon = w_1stWon,
         secondndWon = w_2ndWon,
         SvGms = w_SvGms,
         bpSaved = w_bpSaved,
         bpFaced = w_bpFaced,
         minutes = minutes,
         winner = "winner"
         )


losers <- winners_set %>%
  mutate(seed = loser_seed,
         name = loser_name,
         hand = loser_hand,
         ht = loser_ht,
         age = loser_age,
         rank = loser_rank,
         rankpoints = loser_rank_points,
         ace = l_ace,
         df = l_df,
         svpt = l_svpt,
         firsstIn = l_1stIn,
         firsttWon = l_1stWon,
         secondndWon = l_2ndWon,
         SvGms = l_SvGms,
         bpSaved = l_bpSaved,
         bpFaced = l_bpFaced,
         minutes = minutes,
         winner = "loser"
         )



asdf <- rbind(winners,losers)
```

```{r}
asdf
```



%>%
  group_by(winner_name) %>%
  mutate(mean_w_ace = mean(w_ace),
         mean_w_df = mean(w_df),
         mean_w_svpt = mean(w_svpt),
         mean_w_1stIn = mean(w_1stIn),
         mean_w_1stWon = mean(w_1stWon),
         mean_w_2ndWon = mean(w_2ndWon),
         mean_w_SvGms = mean(w_SvGms),
         mean_w_bpSaved = mean(w_bpSaved),
         mean_w_bpFaced = mean(w_bpFaced),
         mean_minutes = mean(minutes),
         num = n())

myvars <- names(winners_set) %in% c( "loser_seed", "loser_entry", "loser_name",
                             "loser_hand", "loser_ht", "loser_ioc", "loser_age", 
                             "loser_rank", "loser_rank_points", "l_ace", "l_df", 
                             "l_svpt", "l_1stIn", "l_1stWon", "l_2ndWon", "l_SvGms", 
                             "l_bpSaved", "l_bpFaced") 
#loser_id
winners_set <- winners_set[!myvars]


```{r}
winners_set

grass <- winners_set %>%
  filter(surface == "Grass") 

myvars <- names(grass) %in% c("loser_id", "winner_id")

grass <- grass[myvars]

grass 

```



```{r}
winnergrass <- grass %>%
    mutate(id = winner_id)


myvars <- names(winnergrass) %in% c("loser_id", "winner_id")

winnergrass <- winnergrass[!myvars]


winnergrass


losergrass <- grass %>%
  mutate(id = loser_id)


myvars <- names(losergrass) %in% c("loser_id", "winner_id")

losergrass <- losergrass[!myvars]

losergrass


total <- rbind(winnergrass, losergrass)
total

```

```{r}

```

# Exploratory Data Analysis 

To begin our exploratory data analysis, we will examine the matrix plots for all three court surfaces, with the response variable being `num` and all other variables we deemed important in our proposal.

## Matrix Plot
```{r fig.height=11, fig.width=11}
pairs(num ~ winner_seed + winner_ht + winner_age + winner_rank + 
        mean_w_df + mean_w_svpt + mean_w_1stIn + mean_w_1stWon + 
        mean_w_2ndWon + mean_w_SvGms + mean_w_bpSaved + mean_w_bpFaced + 
        mean_minutes, data=winners_set, pch = 16,
      main = "Matrix of scatterplots for Tournament Wins and Variables")
```
# Linear Regression

To begin our regression models, we will

```{r}
fullmodel <- lm(num ~ winner_seed + winner_ht + winner_age + winner_rank + 
        mean_w_df + mean_w_svpt + mean_w_bpSaved + surface, data=winners_set)
tidy(fullmodel)
```

```{r}
backwards <- ols_step_backward_aic(fullmodel)
```

```{r fig.height=11, fig.width=11}
pairs(num ~ winner_seed + winner_ht + winner_age + winner_rank + 
        mean_w_df + mean_w_svpt + mean_w_bpSaved, data=winners_set, pch = 16)
```


# Linear Regression Assumptions

# Hypothesis Tests + Confidence Intervals

# Conclusion








